---
description: How to run and test the Cointracking EVM Importer CLI
alwaysApply: true
---

# CLI Testing Guide

## Quick Reference

```bash
# Interactive mode (prompts for everything)
npm run start # or `npm run convert` without any params


# Convert with explicit files (non-interactive, saves to test-imports/)
npm run convert -- \
  --test \
  --address 0x2e17bc5bc5fa3e6691a0965e240f12fdccd0d1b1 \
  --chain Mantle \
  --nativeSymbol MNT \
  --native test/fixtures/mantle/native.csv \
  --tokens test/fixtures/mantle/tokens.csv \
  --output /tmp/test-output.csv \
  --verbose

# Auto-detect files from a directory
npm run convert data/raw/<import-id>

# Dry run (preview without writing)
npm run convert -- --native test/fixtures/mantle/native.csv --dry-run --verbose

# Clean up test imports
npm run clean:test-imports
```

## Test Mode (`--test`)

Use `--test` for manual CLI testing. This saves imports to `data/test-imports/` instead of `data/imports/`, keeping real imports separate from test artifacts.

- **With `--test`**: Saved to `data/test-imports/` (safe to delete anytime)
- **Without `--test`**: Saved to `data/imports/` (real imports, preserved)

Clean up test artifacts with `npm run clean:test-imports`.

## Test Fixtures

Available in `test/fixtures/mantle/`:
- `native.csv` - Native transactions
- `tokens.csv` - Token transfers

## Common Mistakes to Avoid

| Wrong | Correct |
|-------|---------|
| `npm run convert --native x.csv` | `npm run convert -- --native x.csv` (need `--` before flags) |
| `--address 0x123` | `--address 0x2e17bc5bc5fa3e6691a0965e240f12fdccd0d1b1` (must be 42 chars) |
| `--native ./test/` | `--native ./test/fixtures/mantle/native.csv` (must be a file, not directory) |
| Missing `--address` | Without `--address`, CLI prompts interactively (will hang in non-TTY) |
| Forgetting `--test` | Without `--test`, archives go to `data/imports/` (real imports) |

## Required vs Optional Flags

For non-interactive testing, you need:
1. `--address` - Required (42-char 0x address)
2. At least one input file (`--native`, `--tokens`, `--internal`, `--nft721`, `--nft1155`)
3. `--chain` and `--nativeSymbol` - Optional, defaults prompt interactively

For fully non-interactive: provide `--address`, `--chain`, and `--nativeSymbol`.

**Recommended**: Always use `--test` when manually testing to avoid polluting real imports.
